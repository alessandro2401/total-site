<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora SMT - Movimento Mais Brasil</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e5799 0%, #2989d8 50%, #7db9e8 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #1e5799;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #1e5799;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #2989d8;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: #2989d8;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        input[type="checkbox"] {
            margin-right: 8px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .btn {
            background: #2989d8;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #1e5799;
        }

        .resultado {
            display: none;
        }

        .resultado.show {
            display: block;
        }

        .valor-destaque {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .valor-destaque h3 {
            color: #1e5799;
            margin-bottom: 10px;
        }

        .valor-destaque .valor {
            font-size: 32px;
            font-weight: bold;
            color: #2989d8;
        }

        .tabela-detalhes {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .tabela-detalhes th,
        .tabela-detalhes td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .tabela-detalhes th {
            background: #f5f5f5;
            font-weight: 600;
            color: #1e5799;
        }

        .tabela-detalhes tr:hover {
            background: #f9f9f9;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .info-box {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #2989d8;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .comparacao-antecipacao {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .comparacao-antecipacao h4 {
            color: #1e5799;
            margin-bottom: 15px;
        }

        .opcao-pagamento {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 2px solid #ddd;
        }

        .opcao-pagamento.destaque {
            border-color: #28a745;
            background: #f0fff4;
        }

        .btn-action {
            background: white;
            color: #2989d8;
            padding: 10px 20px;
            border: 2px solid #2989d8;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-action:hover {
            background: #2989d8;
            color: white;
        }

        @media print {
            .header, .card:first-child, .btn, .btn-action {
                display: none !important;
            }
            
            body {
                background: white;
                padding: 0;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .card {
                box-shadow: none;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó Calculadora de Indeniza√ß√£o SMT</h1>
            <p>Movimento Mais Brasil - Socorro M√∫tuo Total</p>
        </div>

        <div class="main-content">
            <!-- FORMUL√ÅRIO -->
            <div class="card">
                <h2>üìã Dados do Sinistro</h2>
                
                <form id="formCalculadora">
                    <!-- Dados do Benefici√°rio -->
                    <div class="form-section">
                        <h3>Dados do Benefici√°rio</h3>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Nome:</label>
                                <input type="text" id="nome_beneficiario" required>
                            </div>
                            <div class="form-group">
                                <label>Data de Entrega da Documenta√ß√£o:</label>
                                <input type="date" id="data_entrega_documentacao" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Dias √öteis para Pagamento:</label>
                            <select id="dias_uteis_pagamento" required>
                                <option value="60">60 dias √∫teis</option>
                                <option value="90" selected>90 dias √∫teis</option>
                            </select>
                        </div>
                    </div>

                    <!-- Identifica√ß√£o -->
                    <div class="form-section">
                        <h3>Identifica√ß√£o do Ve√≠culo</h3>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Ve√≠culo:</label>
                                <input type="text" id="veiculo" required>
                            </div>
                            <div class="form-group">
                                <label>Placa:</label>
                                <input type="text" id="placa" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Valor FIPE (R$):</label>
                            <input type="number" id="valor_fipe" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Sinistro:</label>
                            <select id="tipo_sinistro" required>
                                <option value="">Selecione...</option>
                                <option value="Roubo">Roubo</option>
                                <option value="Furto">Furto</option>
                                <option value="Perda Total">Perda Total (Colis√£o/Capotamento)</option>
                                <option value="Inc√™ndio">Inc√™ndio</option>
                            </select>
                        </div>
                    </div>

                    <!-- Deprecia√ß√µes -->
                    <div class="form-section">
                        <h3>Deprecia√ß√µes Aplic√°veis</h3>
                        <div class="checkbox-group">
                            <input type="checkbox" id="leilao_sinistro">
                            <label for="leilao_sinistro">Ve√≠culo de Leil√£o por Sinistro (-25%)</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="leilao_financeiro">
                            <label for="leilao_financeiro">Ve√≠culo de Leil√£o Financeiro (-15%)</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="beneficio_fiscal">
                            <label for="beneficio_fiscal">Benef√≠cio Fiscal IPI/ICMS (-20%)</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="incendiado_submerso">
                            <label for="incendiado_submerso">Incendiado/Submerso ap√≥s Roubo (-30%)</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="rodas_som_sem_rastreador">
                            <label for="rodas_som_sem_rastreador">Rodas/Som sem Rastreador (-20%)</label>
                        </div>
                        <div class="form-group">
                            <label>Redu√ß√£o de Cota (R$):</label>
                            <input type="number" id="reducao_cota_valor" step="0.01" value="0">
                        </div>
                    </div>

                    <!-- Descontos -->
                    <div class="form-section">
                        <h3>Composi√ß√£o dos Descontos</h3>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>12 Contribui√ß√µes (R$):</label>
                                <input type="number" id="doze_contribuicoes" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label>Despachante (R$):</label>
                                <input type="number" id="despachante" step="0.01" value="120">
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Pr√©via Financiamento (R$):</label>
                                <input type="number" id="previa_financiamento" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label>Baixa do Gravame (R$):</label>
                                <input type="number" id="baixa_gravame" step="0.01" value="0">
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>2¬™ Via ATPVE (R$):</label>
                                <input type="number" id="segunda_via_atpve" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label>Redu√ß√£o de Cota (R$):</label>
                                <input type="number" id="reducao_cota_desconto" step="0.01" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Nota sobre Antecipa√ß√£o -->
                    <div class="form-section">
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 5px; border-left: 4px solid #2196F3;">
                            <strong>üìä Sobre a Antecipa√ß√£o:</strong>
                            <p style="margin-top: 8px; color: #666; font-size: 14px;">
                                O c√°lculo utiliza uma taxa de desconto fixa de <strong>12,7%</strong> sobre o valor a receber, 
                                conforme padr√£o estabelecido para antecipa√ß√£o de indeniza√ß√µes SMT.
                            </p>
                        </div>
                    </div>

                    <!-- Requisitos -->
                    <div class="form-section">
                        <h3>Requisitos</h3>
                        <div class="checkbox-group">
                            <input type="checkbox" id="rastreador_instalado">
                            <label for="rastreador_instalado">Rastreador Instalado e Funcionando</label>
                        </div>
                    </div>

                    <button type="submit" class="btn">üßÆ Calcular Indeniza√ß√£o</button>
                </form>
            </div>

            <!-- RESULTADO -->
            <div class="card resultado" id="resultado">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üí∞ Resultado do C√°lculo</h2>
                    <div>
                        <button onclick="imprimirResultado()" class="btn-action" style="margin-right: 10px;">
                            üñ®Ô∏è Imprimir
                        </button>
                        <button onclick="gerarPDF()" class="btn-action">
                            üìÑ Gerar PDF
                        </button>
                    </div>
                </div>
                
                <div id="alertas"></div>

                <!-- Identifica√ß√£o do Sinistro -->
                <div class="info-box" style="background: #fff9e6; border-left: 4px solid #ffc107;">
                    <h4 style="color: #1e5799; margin-bottom: 10px;">üìã Identifica√ß√£o do Sinistro</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <strong>Benefici√°rio:</strong> <span id="resultNomeBeneficiario"></span>
                        </div>
                        <div>
                            <strong>Placa do Ve√≠culo:</strong> <span id="resultPlaca"></span>
                        </div>
                        <div>
                            <strong>Ve√≠culo:</strong> <span id="resultVeiculo"></span>
                        </div>
                        <div>
                            <strong>Tipo de Sinistro:</strong> <span id="resultTipoSinistro"></span>
                        </div>
                    </div>
                </div>

                <div class="valor-destaque">
                    <h3>Valor L√≠quido da Indeniza√ß√£o</h3>
                    <div class="valor" id="valorLiquido">R$ 0,00</div>
                    <p id="prazoPagamento"></p>
                </div>

                <div class="comparacao-antecipacao">
                    <h4>‚ö° Op√ß√µes de Pagamento</h4>
                    
                    <div class="opcao-pagamento">
                        <strong>üìÖ Op√ß√£o 1: Aguardar Prazo Regulamentar</strong>
                        <p id="opcao1"></p>
                    </div>

                    <div class="opcao-pagamento destaque">
                        <strong>üí∏ Op√ß√£o 2: Receber Antecipado (com desconto)</strong>
                        <p id="opcao2"></p>
                        <p id="detalhesAntecipacao"></p>
                    </div>
                </div>

                <h3>üìä Detalhamento dos C√°lculos</h3>
                
                <div class="info-box">
                    <strong>Valor Base (FIPE):</strong> <span id="valorFipe"></span>
                </div>

                <h4>Deprecia√ß√µes Aplicadas:</h4>
                <table class="tabela-detalhes" id="tabelaDepreciacoes">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Percentual</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <h4>Descontos Aplicados:</h4>
                <table class="tabela-detalhes" id="tabelaDescontos">
                    <thead>
                        <tr>
                            <th>Descri√ß√£o</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <div class="info-box">
                    <strong>Total de Descontos:</strong> <span id="totalDescontos"></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('formCalculadora');
        const resultado = document.getElementById('resultado');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const dados = {
                nome_associado: document.getElementById('nome_beneficiario').value,
                placa: document.getElementById('placa').value,
                veiculo: document.getElementById('veiculo').value,
                valor_fipe: parseFloat(document.getElementById('valor_fipe').value),
                tipo_sinistro: document.getElementById('tipo_sinistro').value,
                data_entrega_documentacao: document.getElementById('data_entrega_documentacao').value,
                dias_uteis_pagamento: parseInt(document.getElementById('dias_uteis_pagamento').value),
                
                leilao_sinistro: document.getElementById('leilao_sinistro').checked,
                leilao_financeiro: document.getElementById('leilao_financeiro').checked,
                beneficio_fiscal: document.getElementById('beneficio_fiscal').checked,
                incendiado_submerso: document.getElementById('incendiado_submerso').checked,
                rodas_som_sem_rastreador: document.getElementById('rodas_som_sem_rastreador').checked,
                reducao_cota_valor: parseFloat(document.getElementById('reducao_cota_valor').value) || 0,
                
                doze_contribuicoes: parseFloat(document.getElementById('doze_contribuicoes').value) || 0,
                despachante: parseFloat(document.getElementById('despachante').value) || 0,
                previa_financiamento: parseFloat(document.getElementById('previa_financiamento').value) || 0,
                baixa_gravame: parseFloat(document.getElementById('baixa_gravame').value) || 0,
                segunda_via_atpve: parseFloat(document.getElementById('segunda_via_atpve').value) || 0,
                reducao_cota_desconto: parseFloat(document.getElementById('reducao_cota_desconto').value) || 0,
                
                rastreador_instalado: document.getElementById('rastreador_instalado').checked
            };

            try {
                const result = calcularIndenizacao(dados);
                exibirResultado(result);
            } catch (error) {
                alert('Erro ao calcular: ' + error.message);
            }
        });

        function calcularIndenizacao(dados) {
            // Constantes
            const TAXA_DESCONTO_FIXA = 0.127; // 12,7% fixo
            
            // Valor FIPE original
            let valor_fipe_original = dados.valor_fipe;
            let valor_base = dados.valor_fipe;
            
            // Deprecia√ß√µes (opcionais, manter da vers√£o anterior)
            let depreciacoes_aplicadas = [];
            let total_depreciacao = 0;
            
            if (dados.leilao_sinistro) {
                let valor_dep = valor_base * 0.25;
                depreciacoes_aplicadas.push({
                    tipo: 'Ve√≠culo de Leil√£o por Sinistro',
                    percentual: 0.25,
                    valor: valor_dep
                });
                total_depreciacao += valor_dep;
            }
            
            if (dados.leilao_financeiro) {
                let valor_dep = valor_base * 0.15;
                depreciacoes_aplicadas.push({
                    tipo: 'Ve√≠culo de Leil√£o Financeiro',
                    percentual: 0.15,
                    valor: valor_dep
                });
                total_depreciacao += valor_dep;
            }
            
            if (dados.beneficio_fiscal) {
                let valor_dep = valor_base * 0.20;
                depreciacoes_aplicadas.push({
                    tipo: 'Benef√≠cio Fiscal IPI/ICMS',
                    percentual: 0.20,
                    valor: valor_dep
                });
                total_depreciacao += valor_dep;
            }
            
            if (dados.incendiado_submerso) {
                let valor_dep = valor_base * 0.30;
                depreciacoes_aplicadas.push({
                    tipo: 'Incendiado/Submerso ap√≥s Roubo',
                    percentual: 0.30,
                    valor: valor_dep
                });
                total_depreciacao += valor_dep;
            }
            
            if (dados.rodas_som_sem_rastreador) {
                let valor_dep = valor_base * 0.20;
                depreciacoes_aplicadas.push({
                    tipo: 'Rodas/Som sem Rastreador',
                    percentual: 0.20,
                    valor: valor_dep
                });
                total_depreciacao += valor_dep;
            }
            
            if (dados.reducao_cota_valor && dados.reducao_cota_valor > 0) {
                depreciacoes_aplicadas.push({
                    tipo: 'Redu√ß√£o de Cota (Deprecia√ß√£o)',
                    percentual: 0,
                    valor: dados.reducao_cota_valor
                });
                total_depreciacao += dados.reducao_cota_valor;
            }
            
            // Valor ap√≥s deprecia√ß√µes
            let valor_apos_depreciacao = valor_base - total_depreciacao;
            
            // Composi√ß√£o dos Descontos (conforme exemplos)
            let descontos_itens = [];
            let total_descontos = 0;
            
            if (dados.doze_contribuicoes && dados.doze_contribuicoes > 0) {
                descontos_itens.push({
                    descricao: '12 Contribui√ß√µes',
                    valor: dados.doze_contribuicoes
                });
                total_descontos += dados.doze_contribuicoes;
            }
            
            if (dados.despachante && dados.despachante > 0) {
                descontos_itens.push({
                    descricao: 'Despachante',
                    valor: dados.despachante
                });
                total_descontos += dados.despachante;
            }
            
            if (dados.previa_financiamento && dados.previa_financiamento > 0) {
                descontos_itens.push({
                    descricao: 'Pr√©via Financiamento',
                    valor: dados.previa_financiamento
                });
                total_descontos += dados.previa_financiamento;
            }
            
            if (dados.baixa_gravame && dados.baixa_gravame > 0) {
                descontos_itens.push({
                    descricao: 'Baixa do Gravame',
                    valor: dados.baixa_gravame
                });
                total_descontos += dados.baixa_gravame;
            }
            
            if (dados.segunda_via_atpve && dados.segunda_via_atpve > 0) {
                descontos_itens.push({
                    descricao: '2¬™ Via ATPVE',
                    valor: dados.segunda_via_atpve
                });
                total_descontos += dados.segunda_via_atpve;
            }
            
            if (dados.reducao_cota_desconto && dados.reducao_cota_desconto > 0) {
                descontos_itens.push({
                    descricao: 'Redu√ß√£o de Cota',
                    valor: dados.reducao_cota_desconto
                });
                total_descontos += dados.reducao_cota_desconto;
            }
            
            // Valor a Receber (conforme exemplos: FIPE - Deprecia√ß√µes - Descontos)
            let valor_a_receber = valor_apos_depreciacao - total_descontos;
            
            // Dias √∫teis para pagamento
            let dias_uteis = dados.dias_uteis_pagamento || 90;
            
            // C√°lculo da Antecipa√ß√£o (desconto fixo de 12,7%)
            let valor_antecipado = valor_a_receber * (1 - TAXA_DESCONTO_FIXA);
            let desconto_aplicado = valor_a_receber - valor_antecipado;
            let taxa_desconto_efetiva = (desconto_aplicado / valor_a_receber) * 100;
            
            // Calcular taxa impl√≠cita mensal
            // valor_antecipado = valor_a_receber / (1 + taxa_mensal)^(dias/30)
            // (1 + taxa_mensal)^(dias/30) = valor_a_receber / valor_antecipado
            // taxa_mensal = (valor_a_receber / valor_antecipado)^(30/dias) - 1
            let meses = dias_uteis / 30;
            let taxa_implicita_mensal = Math.pow(valor_a_receber / valor_antecipado, 1 / meses) - 1;
            let taxa_implicita_anual = taxa_implicita_mensal * 12;
            
            // Calcular data limite para pagamento
            let data_entrega = new Date(dados.data_entrega_documentacao);
            let data_limite = new Date(data_entrega);
            // Simplifica√ß√£o: adicionar dias corridos (em produ√ß√£o, usar c√°lculo de dias √∫teis)
            data_limite.setDate(data_limite.getDate() + Math.floor(dias_uteis * 1.4)); // Aproxima√ß√£o
            
            let data_limite_formatada = data_limite.toLocaleDateString('pt-BR');
            
            // Observa√ß√µes
            let observacoes = [];
            
            if (!dados.rastreador_instalado && dados.rodas_som_sem_rastreador) {
                observacoes.push('‚ö†Ô∏è Deprecia√ß√£o de Rodas/Som aplicada devido √† aus√™ncia de rastreador');
            }
            
            if (valor_a_receber < 0) {
                observacoes.push('‚ùå Valor a receber negativo! Verifique os descontos e deprecia√ß√µes.');
            }
            
            return {
                dados_sinistro: {
                    associado: dados.nome_associado,
                    veiculo: dados.veiculo,
                    placa: dados.placa,
                    valor_fipe: valor_fipe_original,
                    data_entrega_documentacao: new Date(dados.data_entrega_documentacao).toLocaleDateString('pt-BR'),
                    limite_pagamento: data_limite_formatada,
                    dias_uteis: dias_uteis
                },
                depreciacao: {
                    aplicadas: depreciacoes_aplicadas,
                    total: total_depreciacao
                },
                descontos: {
                    itens: descontos_itens,
                    total: total_descontos
                },
                calculo_antecipacao: {
                    valor_a_receber: valor_a_receber,
                    taxa_implicita_mensal: taxa_implicita_mensal * 100,
                    taxa_implicita_anual: taxa_implicita_anual * 100,
                    valor_antecipado: valor_antecipado,
                    desconto_aplicado: desconto_aplicado,
                    taxa_desconto_efetiva: taxa_desconto_efetiva
                },
                observacoes: observacoes
            };
        }

        function exibirResultado(result) {
            // Salvar resultado para uso na gera√ß√£o de PDF
            window.ultimoCalculo = result;
            
            resultado.classList.add('show');
            resultado.scrollIntoView({ behavior: 'smooth' });

            // Preencher identifica√ß√£o do sinistro
            document.getElementById('resultNomeBeneficiario').textContent = result.dados_sinistro.associado;
            document.getElementById('resultPlaca').textContent = result.dados_sinistro.placa;
            document.getElementById('resultVeiculo').textContent = result.dados_sinistro.veiculo;
            document.getElementById('resultTipoSinistro').textContent = document.getElementById('tipo_sinistro').value;

            // Alertas
            const alertas = document.getElementById('alertas');
            alertas.innerHTML = '';
            
            if (result.observacoes && result.observacoes.length > 0) {
                result.observacoes.forEach(msg => {
                    alertas.innerHTML += `<div class="alert alert-warning">${msg}</div>`;
                });
            }

            // Valor L√≠quido (Valor a Receber)
            document.getElementById('valorLiquido').textContent = 
                'R$ ' + result.calculo_antecipacao.valor_a_receber.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            document.getElementById('prazoPagamento').textContent = 
                `Prazo: ${result.dados_sinistro.dias_uteis} dias √∫teis | Limite: ${result.dados_sinistro.limite_pagamento}`;

            // Op√ß√µes de Pagamento
            document.getElementById('opcao1').innerHTML = 
                `Receber <strong>R$ ${result.calculo_antecipacao.valor_a_receber.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong> em ${result.dados_sinistro.dias_uteis} dias √∫teis`;

            document.getElementById('opcao2').innerHTML = 
                `Receber <strong>R$ ${result.calculo_antecipacao.valor_antecipado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong> HOJE (pagamento imediato)`;

            document.getElementById('detalhesAntecipacao').innerHTML = 
                `<small>Desconto: R$ ${result.calculo_antecipacao.desconto_aplicado.toLocaleString('pt-BR', {minimumFractionDigits: 2})} 
                (${result.calculo_antecipacao.taxa_desconto_efetiva.toFixed(2)}%) | 
                Taxa Impl√≠cita: ${result.calculo_antecipacao.taxa_implicita_mensal.toFixed(2)}% ao m√™s 
                (${result.calculo_antecipacao.taxa_implicita_anual.toFixed(2)}% ao ano)</small>`;

            // Valor FIPE
            document.getElementById('valorFipe').textContent = 
                'R$ ' + result.dados_sinistro.valor_fipe.toLocaleString('pt-BR', {minimumFractionDigits: 2});

            // Deprecia√ß√µes
            const tabelaDepreciacoes = document.getElementById('tabelaDepreciacoes').querySelector('tbody');
            tabelaDepreciacoes.innerHTML = '';
            
            if (result.depreciacao.aplicadas.length === 0) {
                tabelaDepreciacoes.innerHTML = '<tr><td colspan="3" style="text-align:center">Nenhuma deprecia√ß√£o aplicada</td></tr>';
            } else {
                result.depreciacao.aplicadas.forEach(dep => {
                    tabelaDepreciacoes.innerHTML += `
                        <tr>
                            <td>${dep.tipo}</td>
                            <td>${(dep.percentual * 100).toFixed(2)}%</td>
                            <td>R$ ${dep.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                        </tr>
                    `;
                });
            }

            // Descontos
            const tabelaDescontos = document.getElementById('tabelaDescontos').querySelector('tbody');
            tabelaDescontos.innerHTML = '';
            
            result.descontos.itens.forEach(desc => {
                tabelaDescontos.innerHTML += `
                    <tr>
                        <td>${desc.descricao}</td>
                        <td>R$ ${desc.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    </tr>
                `;
            });

            document.getElementById('totalDescontos').textContent = 
                'R$ ' + result.descontos.total.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        }

        function imprimirResultado() {
            if (!window.ultimoCalculo) {
                alert('Por favor, calcule a indeniza√ß√£o primeiro!');
                return;
            }
            
            const dados = window.ultimoCalculo;
            
            // Criar janela de impress√£o com o mesmo conte√∫do do PDF
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cen√°rio 01: ${dados.dados_sinistro.nome}</title>
                    <meta charset="UTF-8">
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            margin: 40px;
                            color: #333;
                        }
                        h1 {
                            text-align: center;
                            font-size: 24px;
                            margin-bottom: 30px;
                        }
                        h2 {
                            font-size: 18px;
                            margin-top: 30px;
                            margin-bottom: 15px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 30px;
                        }
                        th, td {
                            border: 1px solid #999;
                            padding: 10px;
                            text-align: left;
                        }
                        th {
                            background-color: #E0E0E0;
                            font-weight: bold;
                        }
                        td:last-child {
                            text-align: right;
                        }
                        tr:last-child td {
                            font-weight: bold;
                        }
                        @media print {
                            body { margin: 20px; }
                        }
                    </style>
                </head>
                <body>
                    <h1>Cen√°rio 01: ${dados.dados_sinistro.nome}</h1>
                    
                    <h2>Dados do Sinistro</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Descri√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Associado</td>
                                <td>${dados.dados_sinistro.nome}</td>
                            </tr>
                            <tr>
                                <td>Ve√≠culo</td>
                                <td>${dados.dados_sinistro.veiculo}</td>
                            </tr>
                            <tr>
                                <td>Placa</td>
                                <td>${dados.dados_sinistro.placa}</td>
                            </tr>
                            <tr>
                                <td>Valor FIPE</td>
                                <td>R$ ${dados.dados_sinistro.valor_fipe.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Entrega da Documenta√ß√£o</td>
                                <td>${dados.dados_sinistro.data_entrega_documentacao}</td>
                            </tr>
                            <tr>
                                <td>Limite para Pagamento</td>
                                <td>${dados.dados_sinistro.limite_pagamento} (${dados.dados_sinistro.dias_uteis} dias √∫teis)</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h2>Composi√ß√£o dos Descontos</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Valor (R$)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>12 Contribui√ß√µes</td>
                                <td>${dados.descontos.contribuicoes.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Despachante</td>
                                <td>${dados.descontos.despachante.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Pr√©via Financiamento</td>
                                <td>${dados.descontos.financiamento.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Baixa do Gravame</td>
                                <td>${dados.descontos.gravame.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>2¬™ Via ATPVE</td>
                                <td>${dados.descontos.atpve.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Total de Descontos</td>
                                <td>${dados.descontos.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h2>C√°lculo da Antecipa√ß√£o</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>M√©trica</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Valor a Receber em ${dados.dados_sinistro.dias_uteis} Dias</td>
                                <td>R$ ${dados.valor_liquido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Taxa Impl√≠cita Mensal (${dados.dados_sinistro.dias_uteis} dias)</td>
                                <td>${dados.taxa_implicita_mensal.toFixed(2)}%</td>
                            </tr>
                            <tr>
                                <td>Taxa Impl√≠cita Anual</td>
                                <td>${dados.taxa_implicita_anual.toFixed(2)}%</td>
                            </tr>
                            <tr>
                                <td>Valor Antecipado (Pagamento Imediato)</td>
                                <td>R$ ${dados.valor_antecipado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Desconto Aplicado</td>
                                <td>R$ ${dados.desconto_aplicado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            printWindow.document.close();
            
            // Aguardar carregamento e imprimir
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }

        async function gerarPDF() {
            if (!window.ultimoCalculo) {
                alert('Por favor, calcule a indeniza√ß√£o primeiro!');
                return;
            }
            
            const dados = window.ultimoCalculo;
            const nomeAssociado = dados.dados_sinistro.associado;
            
            // Formatar data para DD/MM/AAAA
            const formatarData = (dataStr) => {
                const data = new Date(dataStr + 'T00:00:00');
                return data.toLocaleDateString('pt-BR');
            };
            
            // Preparar HTML profissional baseado no modelo
            const conteudoPDF = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Cen√°rio 01: ${nomeAssociado}</title>
                    <style>
                        @page { margin: 2cm; }
                        body {
                            font-family: Arial, sans-serif;
                            padding: 40px;
                            background: white;
                            color: #333;
                        }
                        h1 {
                            text-align: center;
                            font-size: 24px;
                            font-weight: bold;
                            margin-bottom: 40px;
                            color: #000;
                        }
                        h2 {
                            font-size: 18px;
                            font-weight: bold;
                            margin-top: 30px;
                            margin-bottom: 15px;
                            color: #000;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 30px;
                        }
                        th, td {
                            border: 1px solid #999;
                            padding: 10px;
                            text-align: left;
                        }
                        th {
                            background-color: #E0E0E0;
                            font-weight: bold;
                        }
                        td.valor {
                            text-align: right;
                        }
                        tr.total {
                            font-weight: bold;
                        }
                        @media print {
                            body { padding: 20px; }
                            button { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <h1>Cen√°rio 01: ${nomeAssociado}</h1>
                    
                    <h2>Dados do Sinistro</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Descri√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Associado</td>
                                <td>${dados.dados_sinistro.associado}</td>
                            </tr>
                            <tr>
                                <td>Ve√≠culo</td>
                                <td>${dados.dados_sinistro.veiculo}</td>
                            </tr>
                            <tr>
                                <td>Placa</td>
                                <td>${dados.dados_sinistro.placa}</td>
                            </tr>
                            <tr>
                                <td>Valor FIPE</td>
                                <td>R$ ${dados.dados_sinistro.valor_fipe.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Entrega da Documenta√ß√£o</td>
                                <td>${dados.dados_sinistro.data_entrega_documentacao}</td>
                            </tr>
                            <tr>
                                <td>Limite para Pagamento</td>
                                <td>${dados.dados_sinistro.limite_pagamento} (${dados.dados_sinistro.dias_uteis} dias √∫teis)</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h2>Composi√ß√£o dos Descontos</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th class="valor">Valor (R$)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${dados.descontos.itens.map(item => `
                                <tr>
                                    <td>${item.descricao}</td>
                                    <td class="valor">${item.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                                </tr>
                            `).join('')}
                            <tr class="total">
                                <td>Total de Descontos</td>
                                <td class="valor">${dados.descontos.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h2>C√°lculo da Antecipa√ß√£o</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>M√©trica</th>
                                <th class="valor">Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Valor a Receber em ${dados.dados_sinistro.dias_uteis} Dias</td>
                                <td class="valor">R$ ${dados.calculo_antecipacao.valor_a_receber.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Taxa Impl√≠cita Mensal (${dados.dados_sinistro.dias_uteis} dias)</td>
                                <td class="valor">${dados.calculo_antecipacao.taxa_implicita_mensal.toFixed(2)}%</td>
                            </tr>
                            <tr>
                                <td>Taxa Impl√≠cita Anual</td>
                                <td class="valor">${dados.calculo_antecipacao.taxa_implicita_anual.toFixed(2)}%</td>
                            </tr>
                            <tr>
                                <td>Valor Antecipado (Pagamento Imediato)</td>
                                <td class="valor">R$ ${dados.calculo_antecipacao.valor_antecipado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Desconto Aplicado</td>
                                <td class="valor">R$ ${dados.calculo_antecipacao.desconto_aplicado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            </tr>
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            // Abrir em nova janela para impress√£o/PDF
            const janela = window.open('', '_blank');
            janela.document.write(conteudoPDF);
            janela.document.close();
        }
    </script>
</body>
</html>

